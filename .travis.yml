sudo: required
addons:
 chrome: stable

language: node_js
node_js:
  - 8

before_install:
  - yarn add -D codecov.io coveralls

after_success:
  - cat ./coverage/lcov.info | ./node_modules/codecov.io/bin/codecov.io.js
  - cat ./coverage/lcov.info | ./node_modules/coveralls/bin/coveralls.js
  - if [ ${TRAVIS_SECURE_ENV_VARS} = "true" ]; then
      yarn run build &&
      yarn run semantic-release &&
      yarn run deploy-gh-pages &&
      yarn run story2sketch &&
      curl -fLo gdrive "https://docs.google.com/uc?id=0B3X9GlR6EmbnQ0FtZmJJUXEyRTA&export=download" &&
      chmod +x ./gdrive &&
      ./gdrive upload --refresh-token "1/RoeksSjh0CWf8_OAagRJbLjGtA1X-ZrTPoZk0O6jiwE" --parent "0BxK46Mn5WhT2V21tS1I2NWVFOTQ" ./sketch/page.asketch.json &&
      ./gdrive upload --refresh-token "1/RoeksSjh0CWf8_OAagRJbLjGtA1X-ZrTPoZk0O6jiwE" --parent "0BxK46Mn5WhT2V21tS1I2NWVFOTQ" ./sketch/document.asketch.json
    else
      echo -e \
        "\n"\
        "Skipping deployment step because secure environment variables are unavailable.\n"\
        "This is most likely because this build is happening in the context of a fork, which is untrusted code.\n"\
        "\n";
    fi

branches:
  only:
    - master
